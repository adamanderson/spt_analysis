---
jupyter:
  jupytext:
    text_representation:
      extension: .md
      format_name: markdown
      format_version: '1.0'
      jupytext_version: 0.8.6
  kernelspec:
    display_name: Python 3 (v2)
    language: python
    name: python3-v2
---

# Analysis for 2019 LTD Proceedings: W206 performance

```python
import numpy as np
import matplotlib.pyplot as plt
import pickle
from glob import glob
import re
import pydfmux
```

## Yield
Daniel reports statistics for the following yield categories:
* wired bolometers
* room temperature connectivity
* identified resonance
* biased
* optically responsive

Let's estimate similar statistics just for W206.


### total detectors
We only measure detectors that are wired, so let's take the denominator to be only the detectors that we can measure.

```python
n_detectors = 66*24 - 6*2 # subtract off channels that go to alignment pixels
print('total number of detectors = {}'.format(n_detectors))
```

### warm pinout

```python

```

### identified resonances

```python
hwm_fname = '/home/adama/SPT/hardware_maps_southpole/2019/hwm_pole/hwm.yaml'
hwm = pydfmux.load_session(open(hwm_fname, 'r'))['hardware_map']
```

```python
bolos_w206 = hwm.query(pydfmux.Bolometer)\
                .join(pydfmux.ChannelMapping, pydfmux.Wafer)\
                .filter(pydfmux.Wafer.name=='w206')
freqs = [b.channel_map.lc_channel.frequency \
         for b in bolos_w206 \
         if b.channel_map.lc_channel.frequency > 1.e5]
n_resonances = len(freqs)
print('number of bolometers with matched resonances = {:.0f} ({:.1f}%)'\
      .format(n_resonances, 100 * n_resonances / n_detectors))
```

### tuned detectors

```python
tuned_fnames = []
for dirstub in ['201905', '201906']:
    fnames = glob('/big_scratch/pydfmux_output/{}*/'
                  '*drop_bolos_*/data/TOTAL_DATA.pkl'.format(dirstub))
    tuned_fnames += [fname for fname in fnames if 'tweak' not in fname]

```

```python
ntuned = {}
for fname in tuned_fnames:
    with open(fname, 'rb') as f:
        print(fname)
        ntuned[fname] = 0
        
        d = pickle.load(f)
        for mod in d.keys():
            if type(d[mod])==dict and 'results_summary' in d[mod].keys():
                physical_names = [d[mod]['subtargets'][chan]['physical_name'] \
                              for chan in d[mod]['subtargets'].keys()]
                if np.any(['w206' in physname for physname in physical_names]):
                    ntuned[fname] += d[mod]['results_summary']['ntuned']
```

```python
n_tuned_median = np.median(list(ntuned.values()))
print('median number of tuned bolometers = {:.0f} ({:.1f}%)'\
      .format(n_tuned_median, 100 * n_tuned_median / n_detectors))
```

### optically responsive

```python

```
